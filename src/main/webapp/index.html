<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unito</title>
    <!-- import script di Vue.js e BootsTrap -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script> <!-- Vue -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> <!-- Ajax -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"> <!-- BootsTrap -->
    <link href="Style.css" rel="stylesheet" > <!-- Nostro css -->
</head>
<body>
<div id="app">
<!--<button id="showLogin" @click="changeActive" v-show="!isActive" class="w-25 p-3 position-absolute top-50 start-50 translate-middle" >Vai al login</button>-->
<div v-show="isActive" class="w-25 p-3 position-absolute top-50 start-50 translate-middle">

    <form>
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" class="form-control" aria-describedby="emailHelp" id="username">
        </div>
        <div class="form-group">
            <label for="password">Password</label>
             <input type="password" class="form-control" id="password">
        </div>
        <button type="button" class="btn btn-primary" id="logga">Login</button>
    </form>
</div>

<div id="loggato" class="w-25 p-3 position-absolute top-50 start-50 translate-middle">

</div>

</div>
<script>
    // script Vue.js

    Vue.component('App', App);
    Vue.component('Bottoni',Bottoni);

    var App = Vue.extend({
        template: `
<div v-show="isActive" class="w-25 p-3 position-absolute top-50 start-50 translate-middle">

    <form v-on:submit.prevent="login">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" class="form-control" aria-describedby="emailHelp" id="username" required autocomplete="off">
        </div>
        <div class="form-group">
            <label for="password">Password</label>
             <input type="password" class="form-control" id="password" required autocomplete="off">
        </div>
        <input type="submit" class="btn btn-primary" id="logga" value="login">
    </form>

    <div id="loggato"></div>
</div>
    `,
        data() {
            return {
                isActive:true
            };
        }
        ,
        methods: {
            showForm() {
                this.isActive = !this.isActive;
            },

            login(){
                var utente = document.getElementById("username").value;
                var password = document.getElementById("password").value;

                //se il form è compilato mandiamo una richiesta alla servlet che contatta il DAO per vedere se l'account ricevuto in input è valido
                azione = "checkACC";

                var ruolo = "";
                var self = this;
                var a = vm.LoginForm;
                var b = vm.Bottoni;

                $.post("ModificaServlet", {utente: utente, password: password, azione: azione}, function (ServletOutput) {

                    self.ruolo = ServletOutput;

                    if(self.ruolo.trim() === "amministratore" || self.ruolo.trim() === "cliente"){
                        self.showForm();
                        vm.$refs.templateBottoni.showForm();
                    }
                    else{
                        alert("Utente non registrato");
                    }

                });
            }

        }
    });




    var Bottoni = Vue.extend({
        template: `
        <div v-show="isActive">
        <p class='w-25 p-3 position-absolute top-0 start-0'>Sei loggato come Utente</p>
        <button type='button' class='btn btn-primary position-absolute top-0 start-50 '  id='ripetizioni' >Ripetizioni Disponibili</button>
        <button type='button' class='btn btn-primary position-absolute top-0 end-50 ' id='prenotazione'>Cronologia Prenotazioni</button>
        <div  id='loggato' class='position-absolute top-50 start-50 translate-middle'></div>
        </div>
        `,
        data(){
            return {
                isActive:false
            };
        }
    ,
        methods: {
            showForm() {
                this.isActive = !this.isActive;
            }
        }
    });



    var vm = new Vue({

        el: '#app',
        data:{

        }
        });






// script Ajax

$(document).on("click", "#logga", function() { // When HTML DOM "click" event is invoked on element with ID "somebutton", execute the following function...

        var utente = document.getElementById("username").value;
        var password = document.getElementById("password").value;

        $.post("ModificaServlet", {utente: utente, password: password},
            function (data) {

                $("#loggato").html(data);

            });
});


    $(document).on("click", "#ripetizioni", function () {

    clear();

    var azione = "showRipetizioni";

    $.post("ModificaServlet", {azione:azione},function (data) {

        $("#loggato").html(data);

        if (!isEmpty($('#loggato'))){
            vm.formEmpty = false;
        }
        else{
            vm.formEmpty = true;
        }


    },


);

    });

    $(document).on("click", "#prenotazione", function() {

        var azione = "showPrenotazione";

        $.post("ModificaServlet", {azione: azione},
            function (data) {
                $("#loggato").html(data);


            },


        );

    });


</script>
 </body>
 </html>